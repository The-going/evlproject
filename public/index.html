<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.31" />
    <meta name="description" content="Dovetail co-kernel interface for Linux">
<meta name="author" content="Philippe Gerum &lt;rpm@xenomai.org&gt;">

    <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link rel="icon" href="/images/favicon.png" type="image/x-icon" />
    <title>Introduction :: Dovetail</title>
    
    
    <link href="/css/nucleus.css?1538149021" rel="stylesheet">
    <link href="/css/font-awesome.min.css?1538149021" rel="stylesheet">
    <link href="/css/hybrid.css?1538149021" rel="stylesheet">
    <link href="/css/featherlight.min.css?1538149021" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1538149021" rel="stylesheet">
    <link href="/css/auto-complete.css?1538149021" rel="stylesheet">
    <link href="/css/theme.css?1538149021" rel="stylesheet">
    <link href="/css/hugo-theme.css?1538149021" rel="stylesheet">
    
      <link href="/css/theme-blue.css?1538149021" rel="stylesheet">
    

    <script src="/js/jquery-2.x.min.js?1538149021"></script>
    
    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{ 
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a href="/"><img src="/images/logo.png"></a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fa fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Search...">
    <span data-search-clear=""><i class="fa fa-close"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1538149021"></script>
<script type="text/javascript" src="/js/auto-complete.js?1538149021"></script>
<script type="text/javascript">
    
        var baseurl = '\/';
    
</script>
<script type="text/javascript" src="/js/search.js?1538149021"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/pipeline/" title="Interrupt pipeline" class="dd-item 
        
        
        
        ">
      <a href="/pipeline/">
          Interrupt pipeline
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/pipeline/optimistic/" title="Optimistic Interrupt Protection" class="dd-item ">
        <a href="/pipeline/optimistic/">
        Optimistic protection
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/pipeline/porting/" title="Porting" class="dd-item 
        
        
        
        ">
      <a href="/pipeline/porting/">
          Porting
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/pipeline/porting/prerequisites/" title="Prerequisites" class="dd-item ">
        <a href="/pipeline/porting/prerequisites/">
        Prerequisites
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pipeline/porting/irqflow/" title="Interrupt flow" class="dd-item ">
        <a href="/pipeline/porting/irqflow/">
        Interrupt flow
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pipeline/porting/arch/" title="Architecture-specific bits" class="dd-item ">
        <a href="/pipeline/porting/arch/">
        Architecture bits
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pipeline/porting/timer/" title="Timer management" class="dd-item ">
        <a href="/pipeline/porting/timer/">
        Timer management
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pipeline/porting/atomic/" title="Atomic operations" class="dd-item ">
        <a href="/pipeline/porting/atomic/">
        Atomic operations
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pipeline/porting/rawprintk/" title="Raw printk support" class="dd-item ">
        <a href="/pipeline/porting/rawprintk/">
        Serial debugging
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pipeline/porting/misc/" title="Misc" class="dd-item ">
        <a href="/pipeline/porting/misc/">
        Misc
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pipeline/porting/devnotes/" title="Developer&#39;s Notes" class="dd-item ">
        <a href="/pipeline/porting/devnotes/">
        Developer&#39;s Notes
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/pipeline/usage/" title="Usage" class="dd-item 
        
        
        
        ">
      <a href="/pipeline/usage/">
          Usage
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/pipeline/usage/stage_push/" title="Installing the head stage" class="dd-item ">
        <a href="/pipeline/usage/stage_push/">
        Head stage installation
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pipeline/usage/irq_handling/" title="IRQ handling" class="dd-item ">
        <a href="/pipeline/usage/irq_handling/">
        IRQ handling
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pipeline/usage/synthetic/" title="Synthetic IRQs" class="dd-item ">
        <a href="/pipeline/usage/synthetic/">
        Synthetic IRQs
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pipeline/usage/pipeline_inject/" title="IRQ injection" class="dd-item ">
        <a href="/pipeline/usage/pipeline_inject/">
        IRQ injection
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pipeline/usage/stage_escalation/" title="Stage escalation" class="dd-item ">
        <a href="/pipeline/usage/stage_escalation/">
        Stage escalation
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pipeline/usage/interrupt_protection/" title="Interrupt Protection" class="dd-item ">
        <a href="/pipeline/usage/interrupt_protection/">
        Interrupt Protection
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pipeline/usage/locking/" title="Locking" class="dd-item ">
        <a href="/pipeline/usage/locking/">
        Locking
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pipeline/rulesofthumb/" title="Rules Of Thumb" class="dd-item ">
        <a href="/pipeline/rulesofthumb/">
        Rules Of Thumb
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/altsched/" title="Alternate Task Control" class="dd-item 
        
        
        
        ">
      <a href="/altsched/">
          Alternate Task Control
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/contributing/" title="Contributing to Dovetail" class="dd-item 
        
        
        
        ">
      <a href="/contributing/">
          Contributing
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/status/" title="Status" class="dd-item 
        
        
        
        ">
      <a href="/status/">
          Status
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/about/" title="About this site" class="dd-item 
        
        
        
        ">
      <a href="/about/">
          About
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="footer">
      
    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              

        
        <div id="body-inner">
          

        

<span id="sidebar-toggle-span">
<a href="#" id="sidebar-toggle" data-sidebar-toggle=""><i class="fa fa-bars"></i> navigation</a>
</span>

 


<h2 id="dual-kernel-upsides">Introducing Dovetail</h2>

<p>Using Linux as a host for lightweight software cores specialized in
delivering very short and bounded response times has been a popular
way of supporting real-time applications in the embedded space over
the years.</p>

<p>This design - known as the <em>dual kernel</em> approach - introduces a small
real-time infrastructure which schedules time-critical activities
independently from the main kernel. Application threads co-managed by
this infrastructure still benefit from the ancillary kernel services
such as virtual memory management, and can also leverage the rich GPOS
feature set Linux provides such as networking, data storage or GUIs.</p>

<p>Although the real-time infrastructure has to present specific driver
stack and API implementations to applications, there are nonetheless
significant upsides to keeping the real-time core separate from the
GPOS infrastructure:</p>

<ul>
<li><p>because the two kernels are independent, real-time activities are
not serialized with GPOS operations internally, removing potential
delays which might be induced by the non time-critical
work. Likewise, there is no requirement for keeping the GPOS
operations fine-grained and highly preemptible at any time, which
would otherwise induce noticeable overhead on low-end hardware, due
to the requirement for pervasive task priority inheritance and IRQ
threading.</p></li>

<li><p>the functional isolation of the real-time infrastructure from the
rest of the kernel code restricts common bug hunting to the scope of
the smaller kernel, excluding most interactions with the very large
GPOS kernel base.</p></li>

<li><p>with a dedicated infrastructure providing a specific, well-defined
set of real-time services, applications can unambiguously figure out
which API calls are available for supporting time-critical work,
excluding all the rest as being potentially non-deterministic with
respect to response time.</p></li>
</ul>

<p>This documentation presents <em>Dovetail</em>, an effort to integrate the
support for interfacing Linux with a real-time component deeply inside
the host kernel&rsquo;s logic.</p>

<p>The two software layers forming Dovetail are described: firstly the
interrupt pipeline which creates a high-priority execution stage for a
real-time infrastructure, and finally the support for <a href="/altsched/"><em>alternate task
control</em></a> between the Linux
kernel and the real-time component over the <em>kthreads</em> and <em>user</em>
tasks.</p>

<p>Although both layers are likely to be needed for implementing a
real-time component, only the interrupt pipeline has to be enabled in
the early stage of porting Dovetail. Support for alternate task
control builds upon the latter, and may - and should - be postponed
until the pipeline is fully functional on the target architecture or
platform. The code base is specifically maintained in a way which
allows such incremental process.</p>

<div class="notices note" ><p>Dovetail only introduces the basic mechanisms for hosting a real-time
core into the Linux kernel, enabling the common programming model for
its applications in user-space. It does <strong>not</strong> implement the
real-time core per se, which should be provided by a separate kernel
component.</p>
</div>


<h2 id="why-do-we-need-this">Why do we need this?</h2>

<p>Dovetail is the successor to the <em>I-pipe</em>, the interrupt pipeline
implementation <a href="https://xenomai.org/gitlab/xenomai/">Xenomai&rsquo;s Cobalt</a>
real-time core currently relies on. The rationale behind this effort
is about securing the maintenance of this key component of Xenomai so
that it could be maintained with common kernel development knowledge,
at a fraction of the engineering and maintenance cost native
preemption requires. For several reasons, the I-pipe does not qualify.</p>

<p>Maintaining the I-pipe proved to be difficult over the years as
changes to the mainline kernel regularly caused non-trivial code
conflicts, sometimes nasty regressions to us downstream. Although the
concept of interrupt pipelining proved to be correct in delivering
short response time with reasonably limited changes to the original
kernel, the way this mechanism is currently integrated into the
mainline code shows its age, as explained in <a href="https://gitlab.denx.de/Xenomai/xenomai/wikis/Dovetail/">this document</a>.</p>

<h2 id="audience">Audience</h2>

<p>The intended audience of this document is people having common kernel
development knowledge, who may be interested in building a real-time
component on Dovetail, porting it to their architecture or platform of
choice. Knowing about the basics of interrupt flow, IRQ chip and clock
event device drivers in the kernel tree would be a requirement for
porting this code.</p>

<p>However, this document is not suited for getting one&rsquo;s feet wet with
kernel development. Many assumptions about pre-existing knowledge of
the reader regarding kernel fundamentals are made.</p>
	
  
        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


        
        
            <a class="nav nav-next" href="/pipeline/" title="Interrupt pipeline" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
        
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1538149021"></script>
    <script src="/js/perfect-scrollbar.min.js?1538149021"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1538149021"></script>
    <script src="/js/jquery.sticky.js?1538149021"></script>
    <script src="/js/featherlight.min.js?1538149021"></script>
    <script src="/js/html5shiv-printshiv.min.js?1538149021"></script>
    <script src="/js/highlight.pack.js?1538149021"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom.71422.js?1538149021"></script>
    <script src="/js/learn.js?1538149021"></script>
    <script src="/js/hugo-learn.js?1538149021"></script>

    <link href="/mermaid/mermaid.css?1538149021" type="text/css" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1538149021"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

