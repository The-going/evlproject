<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.37.1" />
    <meta name="description" content="Evenless project">
<meta name="author" content="Philippe Gerum &lt;rpm@xenomai.org&gt;">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>IRQ injection :: Evenless project</title>

    
    <link href="/css/nucleus.css?1554394914" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1554394914" rel="stylesheet">
    <link href="/css/hybrid.css?1554394914" rel="stylesheet">
    <link href="/css/featherlight.min.css?1554394914" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1554394914" rel="stylesheet">
    <link href="/css/auto-complete.css?1554394914" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1554394914" rel="stylesheet">
    <link href="/css/theme.css?1554394914" rel="stylesheet">
    <link href="/css/hugo-theme.css?1554394914" rel="stylesheet">
    
      <link href="/css/theme-evl.css?1554394914" rel="stylesheet">
    

    <script src="/js/jquery-3.3.1.min.js?1554394914"></script>

    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="/dovetail/pipeline/usage/pipeline_inject/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a href="/"><img src="/images/evl-silver.png"></a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1554394914"></script>
<script type="text/javascript" src="/js/auto-complete.js?1554394914"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/evenless.org\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1554394914"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/dovetail/" title="Dovetail interface" class="dd-item 
        parent
        
        
        ">
      <a href="/dovetail/">
          &#9656; Dovetail interface
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/dovetail/pipeline/" title="Interrupt pipeline" class="dd-item 
        parent
        
        
        ">
      <a href="/dovetail/pipeline/">
          &rsaquo; Interrupt pipeline
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/dovetail/pipeline/optimistic/" title="Optimistic Interrupt Protection" class="dd-item ">
        <a href="/dovetail/pipeline/optimistic/">
        &rsaquo; Optimistic protection
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/dovetail/pipeline/porting/" title="Porting" class="dd-item 
        
        
        
        ">
      <a href="/dovetail/pipeline/porting/">
          &rsaquo; Porting
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/dovetail/pipeline/porting/prerequisites/" title="Prerequisites" class="dd-item ">
        <a href="/dovetail/pipeline/porting/prerequisites/">
        Prerequisites
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/dovetail/pipeline/porting/irqflow/" title="Interrupt flow" class="dd-item ">
        <a href="/dovetail/pipeline/porting/irqflow/">
        Interrupt flow
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/dovetail/pipeline/porting/atomic/" title="Atomic operations" class="dd-item ">
        <a href="/dovetail/pipeline/porting/atomic/">
        Atomic operations
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/dovetail/pipeline/porting/arch/" title="Architecture-specific bits" class="dd-item ">
        <a href="/dovetail/pipeline/porting/arch/">
        Architecture bits
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/dovetail/pipeline/porting/timer/" title="Timer management" class="dd-item ">
        <a href="/dovetail/pipeline/porting/timer/">
        Timer management
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/dovetail/pipeline/porting/clocksource/" title="Reading clock sources" class="dd-item ">
        <a href="/dovetail/pipeline/porting/clocksource/">
        Clock sources
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/dovetail/pipeline/porting/rawprintk/" title="Raw printk support" class="dd-item ">
        <a href="/dovetail/pipeline/porting/rawprintk/">
        Serial debugging
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/dovetail/pipeline/porting/misc/" title="Misc" class="dd-item ">
        <a href="/dovetail/pipeline/porting/misc/">
        Misc
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/dovetail/pipeline/porting/devnotes/" title="Developer&#39;s Notes" class="dd-item ">
        <a href="/dovetail/pipeline/porting/devnotes/">
        Developer&#39;s Notes
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/dovetail/pipeline/usage/" title="Kernel API" class="dd-item 
        parent
        
        
        ">
      <a href="/dovetail/pipeline/usage/">
          &rsaquo; Kernel API
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/dovetail/pipeline/usage/interrupt_protection/" title="Interrupt Protection" class="dd-item ">
        <a href="/dovetail/pipeline/usage/interrupt_protection/">
        Interrupt Protection
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/dovetail/pipeline/usage/stage_push/" title="Installing the out-of-band stage" class="dd-item ">
        <a href="/dovetail/pipeline/usage/stage_push/">
        OOB stage installation
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/dovetail/pipeline/usage/stage_escalation/" title="Stage escalation" class="dd-item ">
        <a href="/dovetail/pipeline/usage/stage_escalation/">
        Stage escalation
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/dovetail/pipeline/usage/pipeline_inject/" title="IRQ injection" class="dd-item active">
        <a href="/dovetail/pipeline/usage/pipeline_inject/">
        IRQ injection
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/dovetail/pipeline/usage/irq_handling/" title="IRQ handling" class="dd-item ">
        <a href="/dovetail/pipeline/usage/irq_handling/">
        IRQ handling
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/dovetail/pipeline/usage/locking/" title="Locking" class="dd-item ">
        <a href="/dovetail/pipeline/usage/locking/">
        Locking
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/dovetail/pipeline/usage/synthetic/" title="Synthetic IRQs" class="dd-item ">
        <a href="/dovetail/pipeline/usage/synthetic/">
        Synthetic IRQs
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/dovetail/altsched/" title="Alternate scheduling" class="dd-item 
        
        
        
        ">
      <a href="/dovetail/altsched/">
          &rsaquo; Alternate scheduling
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/dovetail/rulesofthumb/" title="Rules Of Thumb" class="dd-item ">
        <a href="/dovetail/rulesofthumb/">
        &rsaquo; Rules Of Thumb
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/core/" title="The EVL core" class="dd-item 
        
        
        
        ">
      <a href="/core/">
          &#9656; Real-time core
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/core/user-api/" title="The EVL library" class="dd-item 
        
        
        
        ">
      <a href="/core/user-api/">
          &rsaquo; Application interface
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/core/user-api/thread/" title="" class="dd-item 
        
        
        
        ">
      <a href="/core/user-api/thread/">
          Thread
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/core/user-api/mutex/" title="Mutex" class="dd-item 
        
        
        
        ">
      <a href="/core/user-api/mutex/">
          Mutex
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/core/user-api/condvar/" title="Condition variable" class="dd-item 
        
        
        
        ">
      <a href="/core/user-api/condvar/">
          Condition variable
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/core/user-api/semaphore/" title="Counting semaphore" class="dd-item 
        
        
        
        ">
      <a href="/core/user-api/semaphore/">
          Counting semaphore
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/core/user-api/clock/" title="Clock element" class="dd-item 
        
        
        
        ">
      <a href="/core/user-api/clock/">
          Clocks
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/core/user-api/timer/" title="Timers" class="dd-item 
        
        
        
        ">
      <a href="/core/user-api/timer/">
          Timer(fd)
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/core/user-api/xbuf/" title="" class="dd-item 
        
        
        
        ">
      <a href="/core/user-api/xbuf/">
          Cross-buffer
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/core/user-api/proxy/" title="File proxy" class="dd-item 
        
        
        
        ">
      <a href="/core/user-api/proxy/">
          File proxy
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/core/user-api/poll/" title="Polling file descriptors" class="dd-item 
        
        
        
        ">
      <a href="/core/user-api/poll/">
          Polling file descriptors
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/core/user-api/io/" title="Out-of-band I/O services" class="dd-item 
        
        
        
        ">
      <a href="/core/user-api/io/">
          Out-of-band I/O
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/core/user-api/scheduling/" title="Scheduling policies" class="dd-item 
        
        
        
        ">
      <a href="/core/user-api/scheduling/">
          Scheduling policies
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/core/user-api/utils/" title="Utilities" class="dd-item 
        
        
        
        ">
      <a href="/core/user-api/utils/">
          Utilities
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/core/user-api/function_index/" title="Function index" class="dd-item 
        
        
        
        ">
      <a href="/core/user-api/function_index/">
          Index
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/core/kernel-api/" title="Driver interface" class="dd-item 
        
        
        
        ">
      <a href="/core/kernel-api/">
          &rsaquo; Driver interface
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/core/kernel-api/file/" title="File description" class="dd-item 
        
        
        
        ">
      <a href="/core/kernel-api/file/">
          File description
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/core/kernel-api/kthread/" title="Kernel threads" class="dd-item 
        
        
        
        ">
      <a href="/core/kernel-api/kthread/">
          Kernel threads
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/core/kernel-api/mutex/" title="Kernel mutexes" class="dd-item 
        
        
        
        ">
      <a href="/core/kernel-api/mutex/">
          Kernel mutexes
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/core/kernel-api/semaphore/" title="Kernel semaphores" class="dd-item 
        
        
        
        ">
      <a href="/core/kernel-api/semaphore/">
          Kernel semaphores
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/core/kernel-api/spinlock/" title="EVL Spinlocks" class="dd-item 
        
        
        
        ">
      <a href="/core/kernel-api/spinlock/">
          EVL Spinlocks
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/core/kernel-api/flag/" title="Event flags" class="dd-item 
        
        
        
        ">
      <a href="/core/kernel-api/flag/">
          Event flags
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/core/kernel-api/clock/" title="" class="dd-item 
        
        
        
        ">
      <a href="/core/kernel-api/clock/">
          Clock devices
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/core/kernel-api/timer/" title="Timers" class="dd-item 
        
        
        
        ">
      <a href="/core/kernel-api/timer/">
          Timers
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/core/kernel-api/xbuf/" title="Using cross-buffers" class="dd-item 
        
        
        
        ">
      <a href="/core/kernel-api/xbuf/">
          Using cross-buffers
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/core/kernel-api/interrupts/" title="Managing IRQs" class="dd-item 
        
        
        
        ">
      <a href="/core/kernel-api/interrupts/">
          Managing IRQs
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/core/kernel-api/function_index/" title="Function index" class="dd-item 
        
        
        
        ">
      <a href="/core/kernel-api/function_index/">
          Index
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/core/build-steps/" title="Building EVL" class="dd-item 
        
        
        
        ">
      <a href="/core/build-steps/">
          &rsaquo; Building EVL
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/core/caveat/" title="Caveat" class="dd-item 
        
        
        
        ">
      <a href="/core/caveat/">
          &rsaquo; Caveat
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/todo/" title="TODO list" class="dd-item 
        
        
        
        ">
      <a href="/todo/">
          &#9656; TODO
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/ports/" title="Status of EVL ports" class="dd-item 
        
        
        
        ">
      <a href="/ports/">
          &#9656; Ports
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/faq/" title="FAQ" class="dd-item 
        
        
        
        ">
      <a href="/faq/">
          &#9656; FAQ
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="footer">
      

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Evenless</a> > <a href='/dovetail/'>Dovetail interface</a> > <a href='/dovetail/pipeline/'>Interrupt pipeline</a> > <a href='/dovetail/pipeline/usage/'>Kernel API</a> > IRQ injection
          
         
          
         
          
         
          
         
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#sending-out-of-band-ipis-to-remote-cpus">Sending out-of-band IPIs to remote CPUs</a></li>
<li><a href="#injecting-an-irq-event-for-the-current-cpu">Injecting an IRQ event for the current CPU</a></li>
<li><a href="#direct-logging-of-an-irq-event">Direct logging of an IRQ event</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              IRQ injection
            </h1>
          

        





<h2 id="sending-out-of-band-ipis-to-remote-cpus">Sending out-of-band IPIs to remote CPUs</h2>

<p>Although the pipeline does not directly use IPIs internally, it
exposes two generic IPI vectors which autonomous cores may use in SMP
configuration for signaling the following events across CPUs:</p>

<ul>
<li><p><code>RESCHEDULE_OOB_IPI</code>, the cross-CPU task reschedule request. This is
available to the core&rsquo;s scheduler for kicking the task rescheduling
procedure on remote CPUs, when the state of their respective
runqueue has changed. For instance, a task sleeping on CPU #1 may be
unblocked by a system call issued from CPU #0: in this case, the
scheduler code running on CPU #0 is supposed to tell CPU #1 that it
should reschedule. Typically, the EVL core does so from its
<code>test_resched()</code> routine.</p></li>

<li><p><code>TIMER_OOB_IPI</code>, the cross-CPU timer reschedule request. Because
software timers are in essence per-CPU beasts, this IPI is available
to the core&rsquo;s timer management code for kicking the hardware timer
programming procedure on remote CPUs, when the state of some
software timer has changed. Typically, stopping a timer from a
remote CPU, or migrating a timer from a CPU to another should
trigger such signal. The EVL core does so from its
<code>evl_program_remote_tick()</code> routine, which is called whenever the
timer with the earliest timeout date enqueued on a remote CPU, may
have changed.</p></li>
</ul>

<p>As their respective name suggests, those two IPIs can be sent from
out-of-band context (as well as in-band), by calling the
<code>irq_pipeline_send_remote()</code> service.</p>

<hr />

<div class="proto"><a name="irq_pipeline_send_remote"></a>
void irq_pipeline_send_remote(unsigned int ipi, const struct cpumask *cpumask)
</div>


<p><li><i>ipi</i><p>The IPI number to send. There are only two legit values for this
argument: either RESCHEDULE_OOB_IPI, or TIMER_OOB_IPI. This is a
low-level service with not much parameter checking, so any other value
is likely to cause havoc.</p>
</li></p>


<p><li><i>cpumask</i><p>A CPU bitmask defining the target CPUs for the signal. The current CPU
is allowed to send a signal to itself, although this may not be the
faster path to running a local handler.</p>
</li></p>


<p>In order to receive these IPIs, an out-of-band handler must have been
set for them, mentioning the <a href="{{ &lt; relref
&quot;dovetail/pipeline/usage/irq_handling.md&quot; &gt;}}">IRQF_OOB flag</a>.</p>

<p><code>irq_pipeline_send_remote()</code> serializes callers internally so that it
may be used from either stages: in-band or out-of-band.</p>

<hr />

<h2 id="injecting-an-irq-event-for-the-current-cpu">Injecting an IRQ event for the current CPU</h2>

<p>In some very specific cases, we may need to inject an IRQ into the
pipeline by software as if such hardware event had happened on the
current CPU. <code>irq_inject_pipeline()</code> does exactly this.</p>

<hr />

<div class="proto"><a name="irq_inject_pipeline"></a>
int irq_inject_pipeline(unsigned int irq)
</div>


<p><li><i>irq</i><p>The IRQ number to inject. A valid interrupt descriptor must exist
for this interrupt.</p>
</li></p>


<p><code>irq_inject_pipeline()</code> fully emulates the receipt of a hardware
event, which means that the common <a href="/dovetail/pipeline/porting/irqflow/#genirq-flow">interrupt pipelining logic</a> applies
to the new event:</p>

<ul>
<li><p>first, any <a href="/dovetail/pipeline/usage/irq_handling/">out-of-band handler</a> is considered for
delivery,</p></li>

<li><p>then such event may be passed down the pipeline to the common
in-band handler(s) in absence of out-of-band handler(s).</p></li>
</ul>

<p>The pipeline priority rules apply accordingly:</p>

<ul>
<li><p>if the caller is in-band, <em>and</em> an out-of-band handler is registered
for the IRQ event, <em>and</em> the out-of-band stage is <a href="/dovetail/pipeline/optimistic/">unstalled</a>, the execution stage
is immediately switched to out-of-band for running the later, then
restored to in-band before <code>irq_inject_pipeline()</code> returns.</p></li>

<li><p>if the caller is out-of-band and there is no out-of-band handler,
the IRQ event is deferred until the in-band stage resumes execution
on the current CPU, at which point it is delivered to any in-band
handler(s).</p></li>

<li><p>in any case, should the current stage receive the IRQ event, the
<a href="/dovetail/pipeline/optimistic/#virtual-i-flag">virtual interrupt state</a> of that stage
is always considered before deciding whether this event should be
delivered immediately to its handler by <code>irq_inject_pipeline()</code>
(<em>unstalled</em> case), or deferred until the stage is unstalled
(<em>stalled</em> case).</p></li>
</ul>

<p>This call returns zero on successful injection, or -EINVAL if the IRQ
has no valid descriptor.</p>

<hr />

<h2 id="direct-logging-of-an-irq-event">Direct logging of an IRQ event</h2>

<p>Sometimes, running the full interrupt delivery logic
<a href="#irq_inject_pipeline"><code>irq_inject_pipeline()</code></a>
implements for feeding an interrupt into the pipeline may be overkill,
because we can make assumptions about the current execution context,
and which stage should handle the event. The following fast helpers
can be used instead in this case:</p>

<hr />

<div class="proto"><a name="irq_post_inband"></a>
void irq_post_inband(unsigned int irq)
</div>


<p><li><i>irq</i><p>The IRQ number to inject into the in-band stage. A valid interrupt
descriptor must exist for this interrupt.</p>
</li></p>


<p>This routine may be used to mark an interrupt as pending directly into
the current CPU&rsquo;s log for the in-band stage. This is useful in either
of these cases:</p>

<ul>
<li><p>you know that the out-of-band stage is current, therefore this event
has to be deferred until the in-band stage resumes on the current
CPU later on. This means that you can simply post it to the in-band
stage directly.</p></li>

<li><p>you know that the in-band stage is current but <a href="/dovetail/pipeline/optimistic/#virtual-i-flag">stalled</a>, therefore
this event can&rsquo;t be immediately delivered, so marking it as pending
into the in-band stage is enough.</p></li>
</ul>

<p>Interrupts must be <a href="/dovetail/pipeline/usage/interrupt_protection/##hard-irq-protection">hard disabled</a> in the CPU before calling this routine.</p>

<hr />

<div class="proto"><a name="irq_post_oob"></a>
void irq_post_oob(unsigned int irq)
</div>


<p><li><i>irq</i><p>The IRQ number to inject into the out-of-band stage. A valid interrupt
descriptor must exist for this interrupt.</p>
</li></p>


<p>This routine may be used to mark an interrupt as pending directly into
the current CPU&rsquo;s log for the out-of-band stage. This is useful in
only one situation: you know that the out-of-band stage is current but
<a href="/dovetail/pipeline/optimistic/#virtual-i-flag">stalled</a>, therefore this event can&rsquo;t be immediately delivered, so marking
it as pending into the out-of-band stage is enough.</p>

<p>Interrupts must be <a href="/dovetail/pipeline/usage/interrupt_protection/##hard-irq-protection">hard disabled</a> in the CPU before calling this routine. If the out-of-band stage
is stalled as expected on entry to this helper, then interrupts must
be hard disabled in the CPU as well anyway.</p>

<hr />


<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/dovetail/pipeline/usage/stage_escalation/" title="Stage escalation"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/dovetail/pipeline/usage/irq_handling/" title="IRQ handling" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1554394914"></script>
    <script src="/js/perfect-scrollbar.min.js?1554394914"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1554394914"></script>
    <script src="/js/jquery.sticky.js?1554394914"></script>
    <script src="/js/featherlight.min.js?1554394914"></script>
    <script src="/js/html5shiv-printshiv.min.js?1554394914"></script>
    <script src="/js/highlight.pack.js?1554394914"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1554394914"></script>
    <script src="/js/learn.js?1554394914"></script>
    <script src="/js/hugo-learn.js?1554394914"></script>

    <link href="/mermaid/mermaid.css?1554394914" type="text/css" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1554394914"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    
  </body>
</html>

